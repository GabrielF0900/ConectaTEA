generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserType {
  PROFISSIONAL
  RESPONSAVEL
}

model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  telefone  String?
  endereco  String?
  tipo      UserType
  criado_em DateTime  @default(now())

  // Relacionamentos
  criancas     Crianca[]     @relation("ResponsavelCrianças")
  profissional Profissional?
}

model Crianca {
  id              Int      @id @default(autoincrement())
  nome            String
  data_nascimento DateTime
  idade           Int      @default(0) // Campo obrigatório com valor padrão
  genero          String
  diagnostico     String
  observacoes     String?
  responsavel_id  Int
  responsavel     User     @relation("ResponsavelCrianças", fields: [responsavel_id], references: [id])

  // Relacionamentos
  sessoes      Sessoes[]
  metas        Meta[]
  prof_crianca ProfissionalCriança[]
}

model Profissional {
  id            Int    @id @default(autoincrement())
  usuario_id    Int    @unique
  especialidade String
  usuario       User   @relation(fields: [usuario_id], references: [id])

  // Relacionamentos
  sessoes      Sessoes[]
  prof_crianca ProfissionalCriança[]
}

model ProfissionalCriança {
  profissional_id Int
  crianca_id      Int

  profissional Profissional @relation(fields: [profissional_id], references: [id])
  crianca      Crianca      @relation(fields: [crianca_id], references: [id])

  @@id([profissional_id, crianca_id])
}

model Sessoes {
  id              Int      @id @default(autoincrement())
  data            DateTime
  descricao       String
  crianca_id      Int
  profissional_id Int

  crianca      Crianca      @relation(fields: [crianca_id], references: [id])
  profissional Profissional @relation(fields: [profissional_id], references: [id])
}

model Meta {
  id          Int      @id @default(autoincrement())
  descricao   String
  crianca_id  Int
  data_inicio DateTime
  data_fim    DateTime

  crianca   Crianca     @relation(fields: [crianca_id], references: [id])
  progresso Progresso[]
}

model Progresso {
  id        Int      @id @default(autoincrement())
  meta_id   Int
  data      DateTime
  descricao String
  status    String

  meta Meta @relation(fields: [meta_id], references: [id])
}
